<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kho Đề Có Sẵn - TOAN.VN</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style_final.css">
    <style>
        body {
            font-family: 'Montserrat', sans-serif;
            margin: 0;
            background: #f5f7fb;
            color: #2c3e50;
        }
        .page-wrapper {
            max-width: 1200px;
            margin: 0 auto;
            padding: 90px 20px 40px;
        }
        .top-bar {
            background: white;
            border-radius: 14px;
            padding: 16px 18px;
            box-shadow: 0 6px 18px rgba(0,0,0,0.06);
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
        }
        .title-block h1 {
            margin: 0;
            font-size: 1.3rem;
            color: #27ae60;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .title-block p {
            margin: 4px 0 0;
            color: #666;
            font-size: 0.95rem;
        }
        .tag-list {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            justify-content: flex-end;
        }
        .tag {
            background: #ecf8f2;
            color: #27ae60;
            padding: 8px 12px;
            border-radius: 999px;
            font-weight: 700;
            font-size: 0.85rem;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            border: 1px solid #d8f0e5;
        }
        .btn-back {
            padding: 10px 14px;
            background: #f4f6f8;
            border: 1px solid #dfe6ee;
            border-radius: 10px;
            font-weight: 700;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: #34495e;
            transition: 0.2s;
        }
        .btn-back:hover { background: #e9f2ff; border-color: #b9d7ff; color: #2980b9; }

        .filter-row {
            margin: 14px 0 8px;
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }
        .filter-row input, .filter-row select {
            padding: 10px 12px;
            border-radius: 10px;
            border: 2px solid #e0e6ed;
            font-size: 0.95rem;
            outline: none;
        }
        #searchInput { min-width: 320px; }
        .filter-row input:focus, .filter-row select:focus { border-color: #27ae60; box-shadow: 0 0 0 3px rgba(39,174,96,0.12); }
        .btn-primary {
            padding: 10px 14px;
            border: none;
            border-radius: 10px;
            font-weight: 700;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: #27ae60;
            color: white;
            box-shadow: 0 4px 12px rgba(39,174,96,0.35);
        }
        .btn-ghost {
            padding: 10px 14px;
            border: none;
            border-radius: 10px;
            font-weight: 700;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: #ecf0f1;
            color: #7f8c8d;
        }

        .term-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 16px;
            margin-top: 10px;
        }
        .term-column {
            background: white;
            border-radius: 14px;
            box-shadow: 0 6px 18px rgba(0,0,0,0.05);
            overflow: hidden;
        }
        .term-header {
            padding: 14px 16px;
            color: white;
        }
        .term-body {
            padding: 14px 16px 18px;
            display: grid;
            gap: 10px;
        }
        .term-btn {
            padding: 12px;
            border-radius: 10px;
            border: 1px solid #e0e6ed;
            background: #f8fafc;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            font-weight: 700;
            transition: 0.2s;
        }
        .term-btn:hover {
            border-color: #27ae60;
            background: #ecf8f2;
            color: #1e8449;
        }
        .term-btn .left {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        .pill {
            padding: 4px 8px;
            border-radius: 999px;
            font-size: 0.8rem;
            font-weight: 700;
            background: #e8f6ef;
            color: #1e8449;
            border: 1px solid #d5eddd;
        }
        .stacked-list { margin-top: 16px; display: grid; gap: 10px; }
        .stacked-item {
            background: white; border-radius: 12px; box-shadow: 0 6px 18px rgba(0,0,0,0.05);
            padding: 14px 16px; display: flex; justify-content: space-between; align-items: center;
            border: 1px solid #e0e6ed; cursor: pointer; transition: 0.2s;
        }
        .stacked-item:hover { border-color: #27ae60; background: #ecf8f2; color: #1e8449; }
        .stacked-item .left { font-weight: 700; }
        .cta {
            margin-top: 18px; text-align: center;
        }
        .cta button {
            background: linear-gradient(135deg, #e67e22, #d35400);
            color: white; border: none; padding: 12px 20px; border-radius: 12px;
            font-weight: 700; letter-spacing: 0.2px;
            cursor: pointer; box-shadow: 0 6px 14px rgba(211, 84, 0, 0.24);
            display: inline-flex; gap: 10px; align-items: center; font-size: 0.98rem;
        }
        .cta button:hover { transform: translateY(-1px); }
        @media (max-width: 768px) {
            .top-bar { flex-direction: column; align-items: flex-start; }
            .tag-list { justify-content: flex-start; }
            .page-wrapper { padding-top: 110px; }
        }
    </style>
</head>
<body>

    <div class="brand-logo" onclick="window.location.href='index.html'" style="cursor: pointer;">
        <h2><i class="fas fa-shapes"></i> TOAN.VN</h2>
        <span>Yêu học toán</span>
    </div>
    <div class="contact-btn" onclick="alert('Hotline: 024.7301.8910')">
        <i class="fas fa-phone-alt"></i> 024.7301.8910
    </div>

    <div class="page-wrapper">
        <div class="top-bar">
            <button class="btn-back" onclick="window.location.href='menu.html'">
                <i class="fas fa-arrow-left"></i> Quay lại danh mục
            </button>
            <div class="title-block">
                <h1 id="pageTitle">Kho đề tạo sẵn</h1>
                <p id="pageSubtitle">Chọn kỳ học và loại đề để luyện tập.</p>
            </div>
            <div class="tag-list">
                <span class="tag"><i class="fas fa-layer-group"></i> <span id="programTag">CT Phổ thông</span></span>
                <span class="tag" style="background:#eef4ff; color:#2c3e50; border-color:#d8e3ff;"><i class="fas fa-user-graduate"></i> <span id="levelTag">Lớp 10</span></span>
            </div>
        </div>

        <div class="filter-row">
            <input id="searchInput" type="text" placeholder="Tìm nhanh tên đề trong khối này..." />
            <select id="yearFilter">
                <option value="all">Năm up đề: Tất cả</option>
                <option value="2025">2025</option>
                <option value="2024">2024</option>
                <option value="2023">2023</option>
                <option value="2022">2022</option>
            </select>
            <button class="btn-primary" onclick="openDetailDirect()"><i class="fas fa-search"></i> Tìm kiếm</button>
            <button class="btn-ghost" onclick="clearFilters()"><i class="fas fa-eraser"></i> Xóa lọc</button>
        </div>

        <div class="term-grid">
            <div class="term-column">
                <div class="term-header" style="background: linear-gradient(135deg, #27ae60, #1e8449);">
                    <h3>Kỳ 1</h3>
                    <p>Các đề luyện tập cho học kỳ 1</p>
                </div>
                <div class="term-body">
                    <div class="term-btn" onclick="gotoDetail('ky1','de15p')">
                        <div class="left"><i class="fas fa-stopwatch"></i> Đề ngắn (15 phút)</div>
                        <span class="pill" data-count="ky1-de15p">0 đề</span>
                    </div>
                    <div class="term-btn" onclick="gotoDetail('ky1','de45p')">
                        <div class="left"><i class="fas fa-clock"></i> Đề trung bình (30-45 phút)</div>
                        <span class="pill" data-count="ky1-de45p">0 đề</span>
                    </div>
                    <div class="term-btn" onclick="gotoDetail('ky1','giuaKy')">
                        <div class="left"><i class="fas fa-calendar-alt"></i> Đề giữa kỳ</div>
                        <span class="pill" data-count="ky1-giuaKy">0 đề</span>
                    </div>
                    <div class="term-btn" onclick="gotoDetail('ky1','cuoiKy')">
                        <div class="left"><i class="fas fa-flag-checkered"></i> Đề cuối kỳ</div>
                        <span class="pill" data-count="ky1-cuoiKy">0 đề</span>
                    </div>
                </div>
            </div>

            <div class="term-column">
                <div class="term-header" style="background: linear-gradient(135deg, #3498db, #2d7cb3);">
                    <h3>Kỳ 2</h3>
                    <p>Các đề luyện tập cho học kỳ 2</p>
                </div>
                <div class="term-body">
                    <div class="term-btn" onclick="gotoDetail('ky2','de15p')">
                        <div class="left"><i class="fas fa-stopwatch"></i> Đề ngắn (15 phút)</div>
                        <span class="pill" data-count="ky2-de15p">0 đề</span>
                    </div>
                    <div class="term-btn" onclick="gotoDetail('ky2','de45p')">
                        <div class="left"><i class="fas fa-clock"></i> Đề trung bình (30-45 phút)</div>
                        <span class="pill" data-count="ky2-de45p">0 đề</span>
                    </div>
                    <div class="term-btn" onclick="gotoDetail('ky2','giuaKy')">
                        <div class="left"><i class="fas fa-calendar-alt"></i> Đề giữa kỳ</div>
                        <span class="pill" data-count="ky2-giuaKy">0 đề</span>
                    </div>
                    <div class="term-btn" onclick="gotoDetail('ky2','cuoiKy')">
                        <div class="left"><i class="fas fa-flag-checkered"></i> Đề cuối kỳ</div>
                        <span class="pill" data-count="ky2-cuoiKy">0 đề</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="stacked-list">
            <div class="stacked-item" onclick="gotoDetail('all','khaoSat')">
                <div class="left"><i class="fas fa-chart-line"></i> Đề khảo sát chất lượng</div>
                <span class="pill" data-count="all-khaoSat">0 đề</span>
            </div>
            <div class="stacked-item" onclick="gotoDetail('all','thiThu')">
                <div class="left"><i class="fas fa-tasks"></i> Đề thi thử</div>
                <span class="pill" data-count="all-thiThu">0 đề</span>
            </div>
            <div class="stacked-item" onclick="gotoDetail('all','hsg')">
                <div class="left"><i class="fas fa-medal"></i> Đề thi HSG</div>
                <span class="pill" data-count="all-hsg">0 đề</span>
            </div>
        </div>

        <div class="cta">
            <button onclick="tuTaoNgay()"><i class="fas fa-magic"></i> Không tìm thấy đề bạn muốn luyện? Tự tạo ngay!</button>
        </div>
    </div>

    <script>
        const PROGRAM_LABELS = {
            PhoThong: "Chương trình Phổ thông",
            ChuyenCap: "Thi chuyển cấp",
            KyThiRieng: "Kỳ thi riêng",
            QuocTe: "Toán quốc tế"
        };

        const LEVEL_LABELS = {
            Lop1: "Lớp 1", Lop2: "Lớp 2", Lop3: "Lớp 3", Lop4: "Lớp 4", Lop5: "Lớp 5",
            Lop6: "Lớp 6", Lop7: "Lớp 7", Lop8: "Lớp 8", Lop9: "Lớp 9",
            Lop10: "Lớp 10", Lop11: "Lớp 11", Lop12: "Lớp 12",
            Vao6: "Thi vào lớp 6 CLC", Vao10: "Thi vào lớp 10", THPTQG: "Tốt nghiệp THPT & ĐH",
            HSA: "HSA - ĐGNL ĐHQG Hà Nội", TSA: "TSA - ĐGTD Bách Khoa",
            VACT: "V-ACT", SuPham: "Đánh giá Sư phạm", CongAn: "Đánh giá Bộ Công An",
            SAT: "SAT Math", IGCSE: "IGCSE", ALevel: "A-Level", ASLevel: "AS-Level"
        };

        const TOPIC_PRESETS = {
            Lop10: { ky1: ["Mệnh đề - Tập hợp", "BPT bậc nhất hai ẩn", "Hàm số bậc hai", "Thống kê cơ bản"], ky2: ["BPT bậc hai", "Tổ hợp - Xác suất", "Vectơ & Tích vô hướng", "Phương trình đường thẳng"] },
            Lop11: { ky1: ["Góc lượng giác", "Giá trị lượng giác", "Hàm số lượng giác", "Dãy số & Giới hạn"], ky2: ["Cấp số cộng/nhân", "Giới hạn hàm số", "Đạo hàm và ứng dụng", "Hình học không gian"] },
            Lop12: { ky1: ["Ứng dụng đạo hàm", "Hàm số mũ - Logarit", "Nguyên hàm - Tích phân", "Số phức"], ky2: ["Hình học Oxyz", "Vectơ và mặt phẳng", "Khối đa diện", "Khối tròn xoay"] },
            Lop9: { ky1: ["Căn bậc hai", "Đường tròn", "Hệ thức lượng", "Hàm số bậc nhất"], ky2: ["Hàm số bậc hai", "Hình lăng trụ", "Thống kê", "Tọa độ Oxy"] },
            Lop8: { ky1: ["Đa thức", "Phân thức", "Hình bình hành", "Hình thoi"], ky2: ["Hình trụ - Nón", "Thống kê", "Bất phương trình", "Tứ giác nội tiếp"] }
        };

        const CATEGORY_DEFS = {
            de15p: { label: "Đề ngắn (15 phút)", duration: "15 phút" },
            de45p: { label: "Đề trung bình (30-45 phút)", duration: "40 phút" },
            giuaKy: { label: "Đề giữa kỳ", duration: "60 phút" },
            cuoiKy: { label: "Đề cuối kỳ", duration: "90 phút" },
            khaoSat: { label: "Đề khảo sát chất lượng", duration: "60 phút" },
            thiThu: { label: "Đề thi thử", duration: "90 phút" },
            hsg: { label: "Đề thi HSG", duration: "120 phút" }
        };

        const SCHOOL_POOL = [
            "THPT Trần Phú", "THPT Chuyên Hà Nội - Amsterdam", "THPT Chuyên Vinh",
            "THPT Nguyễn Huệ", "THCS-THPT Lương Thế Vinh", "THPT Phan Bội Châu"
        ];

        const YEARS = [2025, 2024, 2023, 2022];

        function pickSchool(idx) {
            return SCHOOL_POOL[idx % SCHOOL_POOL.length];
        }

        function generateList(levelKey, term, category) {
            const preset = TOPIC_PRESETS[levelKey] || { ky1: ["Ôn tập chủ đề 1", "Ôn tập chủ đề 2", "Ôn tập chủ đề 3"], ky2: ["Ôn tập chủ đề 1", "Ôn tập chủ đề 2", "Ôn tập chủ đề 3"] };
            const topics = term === "ky2" ? (preset.ky2 || preset.ky1) : preset.ky1;
            const topicPool = term === "all" ? [...(preset.ky1 || []), ...(preset.ky2 || [])] : topics;
            const list = [];
            const baseTopics = topicPool.length ? topicPool : ["Ôn tập tổng hợp"];
            const catLabel = CATEGORY_DEFS[category]?.label || "Đề luyện tập";
            const termLabel = term === "ky1" ? "Kỳ 1" : term === "ky2" ? "Kỳ 2" : "Kỳ 1-2";

            if (category === "giuaKy" || category === "cuoiKy" || category === "khaoSat" || category === "thiThu" || category === "hsg") {
                const need = Math.min(8, Math.max(5, baseTopics.length + 1));
                for (let i = 0; i < need; i++) {
                    const year = YEARS[i % YEARS.length];
                    const termNum = term === "ky2" ? 2 : 1;
                    let title;
                    if (category === "giuaKy") {
                        title = `Giữa kỳ ${termNum} năm ${year}`;
                    } else if (category === "cuoiKy") {
                        title = `Đề cuối kỳ ${termNum} năm ${year}`;
                    } else if (category === "khaoSat" || category === "thiThu" || category === "hsg") {
                        const school = pickSchool(i);
                        title = `${school} - ${catLabel.replace("Đề ", "")} năm ${year}`;
                    } else {
                        const school = pickSchool(i);
                        title = `${school} - ${catLabel.replace("Đề ", "")} ${termLabel} ${year}`;
                    }
                    list.push({ title, topic: "Tổng hợp", year });
                }
            } else {
                baseTopics.forEach((topic, idx) => {
                    const year = YEARS[idx % YEARS.length];
                    const minute = category === "de45p" ? (idx % 2 === 0 ? 30 : 45) : 15;
                    const title = category === "de45p"
                        ? `Đề ${minute} phút - ${topic}`
                        : `${catLabel} - ${topic}`;
                    list.push({ title, topic, year });
                });
            }
            return list.slice(0, 8);
        }

        function gotoDetail(term, category) {
            const program = localStorage.getItem("deCoSan_program") || "PhoThong";
            const level = localStorage.getItem("deCoSan_level") || "Lop10";
            const year = document.getElementById("yearFilter").value || "all";
            const keyword = document.getElementById("searchInput").value || "";
            localStorage.setItem("deCoSan_term", term);
            localStorage.setItem("deCoSan_category", category);
            localStorage.setItem("deCoSan_yearFilter", year);
            localStorage.setItem("deCoSan_keyword", keyword);
            localStorage.setItem("deCoSan_program", program);
            localStorage.setItem("deCoSan_level", level);
            window.location.href = "de_tao_san_term.html";
        }

        function openDetailDirect() {
            // Nếu chỉ bấm tìm kiếm chung thì mặc định mở kỳ 1 - 15p
            gotoDetail("ky1", "de15p");
        }

        function clearFilters() {
            document.getElementById("searchInput").value = "";
            document.getElementById("yearFilter").value = "all";
        }

        (function initPage() {
            const program = localStorage.getItem("deCoSan_program") || "PhoThong";
            const level = localStorage.getItem("deCoSan_level") || "Lop10";
            const programLabel = PROGRAM_LABELS[program] || "Chương trình khác";
            const levelLabel = LEVEL_LABELS[level] || level;

            document.getElementById("pageTitle").innerText = "Kho đề tạo sẵn";
            document.getElementById("pageSubtitle").innerText = `${programLabel} · ${levelLabel}`;
            document.getElementById("programTag").innerText = programLabel;
            document.getElementById("levelTag").innerText = levelLabel;

            // Giữ nguyên bộ lọc khi quay lại
            const savedYear = localStorage.getItem("deCoSan_yearFilter");
            const savedKeyword = localStorage.getItem("deCoSan_keyword");
            if (savedYear) document.getElementById("yearFilter").value = savedYear;
            if (savedKeyword) document.getElementById("searchInput").value = savedKeyword;

            // cập nhật số lượng đề
            updateCounts(level);
        })();

        function updateCounts(level) {
            const terms = ["ky1", "ky2"];
            const cats = ["de15p", "de45p", "giuaKy", "cuoiKy"];
            terms.forEach(term => {
                cats.forEach(cat => {
                    const count = generateList(level, term, cat).length;
                    const el = document.querySelector(`[data-count="${term}-${cat}"]`);
                    if (el) el.innerText = `${count} đề`;
                });
            });
            ["khaoSat", "thiThu", "hsg"].forEach(cat => {
                const count = generateList(level, "all", cat).length;
                const el = document.querySelector(`[data-count="all-${cat}"]`);
                if (el) el.innerText = `${count} đề`;
            });
        }

        function tuTaoNgay() {
            localStorage.setItem('cheDoLuyenDe', 'TuTao');
            const level = localStorage.getItem("deCoSan_level");
            if (level === 'Lop10') {
                window.location.href = 'lop10_tutao.html';
                return;
            }
            if (level === 'Lop11') {
                window.location.href = 'lop11_tutao.html';
                return;
            }
            if (level === 'Lop12') {
                window.location.href = 'lop12_tutao.html';
                return;
            }
            window.location.href = 'index.html';
        }
    </script>
</body>
</html>

